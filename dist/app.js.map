{"version":3,"sources":["app.js"],"names":["_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","TypeError","ComponentManager","permissions","onReady","sentMessages","messageQueue","loggingEnabled","acceptsThemes","activeThemes","initialPermissions","onReadyCallback","coallesedSaving","coallesedSavingDelay","registerMessageHandler","value","_this","messageHandler","event","mobileSource","console","log","data","origin","JSON","parse","handleMessage","document","addEventListener","window","payload","action","sessionKey","componentData","activateThemes","themes","original","originalMessage","filter","message","messageId","alert","callback","requestPermissions","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","Symbol","iterator","_step","next","done","postMessage","err","return","environment","platform","uuid","activeThemeUrls","getSelfComponentUUID","isRunningInDesktopApplication","setComponentDataValueForKey","clearComponentData","componentDataValueForKey","push","generateUUID","api","sentMessage","stringify","parent","setSize","type","width","height","bind","streamItems","contentTypes","Array","isArray","content_types","items","streamContextItem","item","selectItem","jsonObjectForItem","createItem","associateItem","createItems","_this2","mapped","map","deassociateItem","clearSelection","content_type","deleteItem","deleteItems","params","sendCustomEvent","saveItem","skipDebouncer","arguments","saveItems","saveItemWithPresave","presave","saveItemsWithPresave","_this3","saveBlock","mappedItems","updated_at","Date","pendingSave","clearTimeout","setTimeout","copy","assign","children","getItemAppDataValue","AppDomain","content","appData","incomingUrls","sort","toString","themesToActivate","themesToDeactivate","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","activeUrl","includes","candidate","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","theme","deactivateTheme","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_iterator4","_step4","url","link","createElement","id","btoa","href","rel","media","className","getElementsByTagName","appendChild","themeElementForUrl","elements","from","getElementsByClassName","slice","find","element","disabled","parentNode","removeChild","crypto","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","d","getTime","performance","now","Math","random","floor","module","exports","SNTheme","SNSmartTag","SNServerExtension","SNMfa","SNEncryptedStorage","SNTag","SNNote","SNExtension","Action","SNEditor","SNComponent","_get","get","object","property","receiver","Function","desc","getOwnPropertyDescriptor","getPrototypeOf","getter","call","_standardFileJs","require","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","_SFItem","json_obj","disassociatedItemIds","associatedItemIds","mapContentToLocalProperties","hosted_url","legacy_url","local_url","offlineOnly","valid_until","name","autoupdateDisabled","package_info","area","active","handleDeletedContent","structureParams","superParams","isEditor","isTheme","isDefaultEditor","getAppDataItem","setLastSize","size","setAppDataItem","getLastSize","getClientDataKey","hasValidHostedUrl","keysToIgnoreWhenCheckingContentEquality","concat","isAssociative","Component","associativeAreas","associateWithItem","isExplicitlyEnabledForItem","indexOf","isExplicitlyDisabledForItem","SFItem","_SFItem2","notes","default","systemEditor","referenceParams","references","_","note","addItemAsRelationship","removeItemAsRelationship","pull","removeAndDirtyAllRelationships","removeReferencesNotPresentIn","uuids","ref","forEach","remove","potentialItemOfInterestHasChangedItsUUID","newItem","oldUUID","newUUID","setData","dataHasChanged","dataForKey","json","merge","running","error","lastExecuted","_SFItem3","actions","actionsWithContextForItem","context","description","supported_types","a","omit","_SFItem4","_this4","text","tags","title","setIsBeingReferencedBy","clearSavedTagsString","setIsNoLongerBeingReferencedBy","isBeingRemovedLocally","tag","informReferencesOfUUIDChange","tagDidFinishSyncing","safeText","safeTitle","savedTagsString","tagsString","arrayToDisplayString","filterDummyNotes","filtered","dummy","_SFItem5","_this5","updateLocalRelationships","_this6","didFinishSyncing","isSmartTag","b","join","_SFItem6","apply","storage","_SFItem7","doNotEncrypt","_SFItem8","_SNTag","json_ob","_this10","systemSmartTags","SystemSmartTagIdAllNotes","isSystemTag","isAllTag","predicate","SFPredicate","fromArray","SystemSmartTagIdArchivedNotes","isArchiveTag","SystemSmartTagIdTrashedNotes","isTrashTag","_SNComponent","_this11","isLayerable","layerable","setMobileRules","rules","getMobileRules","constants","hasMobileRules","setNotAvailOnMobile","na","getNotAvailOnMobile","setMobileActive","isMobileActive","e","angular","HomeCtrl","$rootScope","$scope","$timeout","smartTagContentType","componentManager","delimiter","resolveRawTags","masterTag","sortTags","resolved","rawTags","findResolvedTag","pendingDummy","unshift","comps","split","displayTitle","getParent","depth","parentTitle","tagTitle","index","splice","selectedTag","setSelectedForTag","changeParent","sourceId","targetId","source","needsSave","adjustChildren","child","newTitle","master","createTag","startsWith","components","substring","smartTag","keypath","operator","createdTag","selectOnLoad","selectTag","multiSelect","clearMultipleTagsSelection","multipleTags","smartMaster","createEphemeralSmartTagForMultiTags","editing","tagNames","toggleCollapse","clientData","collapsed","saveTags","selected","newTags","allTags","smartTags","smartMasterTag","arrayToUse","existing","tagCandidate","deleted","deleteTag","deleteChain","addChildren","$$ngIsClass","controller","directive","restrict","scope","shouldFocus","$element","focus","tagId","drop","isDraggable","isDroppable","attrs","el","draggable","counter","dataTransfer","effectAllowed","classList","add","dropEffect","preventDefault","stopPropagation","getData","$apply","TagTree","templateUrl","onSelect","onToggleCollapse","onDrop","onDragOver","onDragStart","ctrlKey","metaKey","addChild","$event","addingTag","saveNewTag","removeTag","innerCollapse","saveTagRename","renameChildren","generationForTag","generation","circleClassForTag","gen","circleClass"],"mappings":"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","file":"app.js","sourcesContent":["\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ComponentManager = function () {\n  function ComponentManager(permissions, onReady) {\n    _classCallCheck(this, ComponentManager);\n\n    this.sentMessages = [];\n    this.messageQueue = [];\n    this.loggingEnabled = false;\n    this.acceptsThemes = true;\n    this.activeThemes = [];\n\n    this.initialPermissions = permissions;\n    this.onReadyCallback = onReady;\n\n    this.coallesedSaving = true;\n    this.coallesedSavingDelay = 250;\n\n    this.registerMessageHandler();\n  }\n\n  _createClass(ComponentManager, [{\n    key: \"registerMessageHandler\",\n    value: function registerMessageHandler() {\n      var _this = this;\n\n      var messageHandler = function messageHandler(event, mobileSource) {\n        if (_this.loggingEnabled) {\n          console.log(\"Components API Message received:\", event.data, \"mobile?\", mobileSource);\n        }\n\n        // The first message will be the most reliable one, so we won't change it after any subsequent events,\n        // in case you receive an event from another window.\n        if (!_this.origin) {\n          _this.origin = event.origin;\n        }\n        _this.mobileSource = mobileSource;\n        // If from mobile app, JSON needs to be used.\n        var data = mobileSource ? JSON.parse(event.data) : event.data;\n        _this.handleMessage(data);\n      };\n\n      // Mobile (React Native) uses `document`, web/desktop uses `window`.addEventListener\n      // for postMessage API to work properly.\n\n      document.addEventListener(\"message\", function (event) {\n        messageHandler(event, true);\n      }, false);\n\n      window.addEventListener(\"message\", function (event) {\n        messageHandler(event, false);\n      }, false);\n    }\n  }, {\n    key: \"handleMessage\",\n    value: function handleMessage(payload) {\n      if (payload.action === \"component-registered\") {\n        this.sessionKey = payload.sessionKey;\n        this.componentData = payload.componentData;\n\n        this.onReady(payload.data);\n\n        if (this.loggingEnabled) {\n          console.log(\"Component successfully registered with payload:\", payload);\n        }\n      } else if (payload.action === \"themes\") {\n        if (this.acceptsThemes) {\n          this.activateThemes(payload.data.themes);\n        }\n      } else if (payload.original) {\n        // get callback from queue\n        var originalMessage = this.sentMessages.filter(function (message) {\n          return message.messageId === payload.original.messageId;\n        })[0];\n\n        if (!originalMessage) {\n          // Connection must have been reset. Alert the user.\n          alert(\"This extension is attempting to communicate with Standard Notes, but an error is preventing it from doing so. Please restart this extension and try again.\");\n        }\n\n        if (originalMessage.callback) {\n          originalMessage.callback(payload.data);\n        }\n      }\n    }\n  }, {\n    key: \"onReady\",\n    value: function onReady(data) {\n      if (this.initialPermissions && this.initialPermissions.length > 0) {\n        this.requestPermissions(this.initialPermissions);\n      }\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.messageQueue[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var message = _step.value;\n\n          this.postMessage(message.action, message.data, message.callback);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      this.messageQueue = [];\n      this.environment = data.environment;\n      this.platform = data.platform;\n      this.uuid = data.uuid;\n\n      if (this.loggingEnabled) {\n        console.log(\"onReadyData\", data);\n      }\n\n      this.activateThemes(data.activeThemeUrls || []);\n\n      if (this.onReadyCallback) {\n        this.onReadyCallback();\n      }\n    }\n  }, {\n    key: \"getSelfComponentUUID\",\n    value: function getSelfComponentUUID() {\n      return this.uuid;\n    }\n  }, {\n    key: \"isRunningInDesktopApplication\",\n    value: function isRunningInDesktopApplication() {\n      return this.environment === \"desktop\";\n    }\n  }, {\n    key: \"setComponentDataValueForKey\",\n    value: function setComponentDataValueForKey(key, value) {\n      this.componentData[key] = value;\n      this.postMessage(\"set-component-data\", { componentData: this.componentData }, function (data) {});\n    }\n  }, {\n    key: \"clearComponentData\",\n    value: function clearComponentData() {\n      this.componentData = {};\n      this.postMessage(\"set-component-data\", { componentData: this.componentData }, function (data) {});\n    }\n  }, {\n    key: \"componentDataValueForKey\",\n    value: function componentDataValueForKey(key) {\n      return this.componentData[key];\n    }\n  }, {\n    key: \"postMessage\",\n    value: function postMessage(action, data, callback) {\n      if (!this.sessionKey) {\n        this.messageQueue.push({\n          action: action,\n          data: data,\n          callback: callback\n        });\n        return;\n      }\n\n      var message = {\n        action: action,\n        data: data,\n        messageId: this.generateUUID(),\n        sessionKey: this.sessionKey,\n        api: \"component\"\n      };\n\n      var sentMessage = JSON.parse(JSON.stringify(message));\n      sentMessage.callback = callback;\n      this.sentMessages.push(sentMessage);\n\n      // Mobile (React Native) requires a string for the postMessage API.\n      if (this.mobileSource) {\n        message = JSON.stringify(message);\n      }\n\n      if (this.loggingEnabled) {\n        console.log(\"Posting message:\", message);\n      }\n\n      window.parent.postMessage(message, this.origin);\n    }\n  }, {\n    key: \"setSize\",\n    value: function setSize(type, width, height) {\n      this.postMessage(\"set-size\", { type: type, width: width, height: height }, function (data) {});\n    }\n  }, {\n    key: \"requestPermissions\",\n    value: function requestPermissions(permissions, callback) {\n      this.postMessage(\"request-permissions\", { permissions: permissions }, function (data) {\n        callback && callback();\n      }.bind(this));\n    }\n  }, {\n    key: \"streamItems\",\n    value: function streamItems(contentTypes, callback) {\n      if (!Array.isArray(contentTypes)) {\n        contentTypes = [contentTypes];\n      }\n      this.postMessage(\"stream-items\", { content_types: contentTypes }, function (data) {\n        callback(data.items);\n      }.bind(this));\n    }\n  }, {\n    key: \"streamContextItem\",\n    value: function streamContextItem(callback) {\n      this.postMessage(\"stream-context-item\", null, function (data) {\n        var item = data.item;\n        /*\n          When an item is saved via saveItem, its updated_at value is set client side to the current date.\n          If we make a change locally, then for whatever reason receive an item via streamItems/streamContextItem,\n          we want to ignore that change if it was made prior to the latest change we've made.\n           Update 1/22/18: However, if a user is restoring a note from version history, this change\n          will not pass through this filter and will thus be ignored. Because the client now handles\n          this case with isMetadataUpdate, we no longer need the below.\n        */\n        // if(this.streamedContextItem && this.streamedContextItem.uuid == item.uuid\n        //   && this.streamedContextItem.updated_at > item.updated_at) {\n        //   return;\n        // }\n        // this.streamedContextItem = item;\n        callback(item);\n      });\n    }\n  }, {\n    key: \"selectItem\",\n    value: function selectItem(item) {\n      this.postMessage(\"select-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"createItem\",\n    value: function createItem(item, callback) {\n      this.postMessage(\"create-item\", { item: this.jsonObjectForItem(item) }, function (data) {\n        var item = data.item;\n\n        // A previous version of the SN app had an issue where the item in the reply to create-item\n        // would be nested inside \"items\" and not \"item\". So handle both cases here.\n        if (!item && data.items && data.items.length > 0) {\n          item = data.items[0];\n        }\n\n        this.associateItem(item);\n        callback && callback(item);\n      }.bind(this));\n    }\n  }, {\n    key: \"createItems\",\n    value: function createItems(items, callback) {\n      var _this2 = this;\n\n      var mapped = items.map(function (item) {\n        return _this2.jsonObjectForItem(item);\n      });\n      this.postMessage(\"create-items\", { items: mapped }, function (data) {\n        callback && callback(data.items);\n      }.bind(this));\n    }\n  }, {\n    key: \"associateItem\",\n    value: function associateItem(item) {\n      this.postMessage(\"associate-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"deassociateItem\",\n    value: function deassociateItem(item) {\n      this.postMessage(\"deassociate-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"clearSelection\",\n    value: function clearSelection() {\n      this.postMessage(\"clear-selection\", { content_type: \"Tag\" });\n    }\n  }, {\n    key: \"deleteItem\",\n    value: function deleteItem(item, callback) {\n      this.deleteItems([item], callback);\n    }\n  }, {\n    key: \"deleteItems\",\n    value: function deleteItems(items, callback) {\n      var params = {\n        items: items.map(function (item) {\n          return this.jsonObjectForItem(item);\n        }.bind(this))\n      };\n\n      this.postMessage(\"delete-items\", params, function (data) {\n        callback && callback(data);\n      });\n    }\n  }, {\n    key: \"sendCustomEvent\",\n    value: function sendCustomEvent(action, data, callback) {\n      this.postMessage(action, data, function (data) {\n        callback && callback(data);\n      }.bind(this));\n    }\n  }, {\n    key: \"saveItem\",\n    value: function saveItem(item, callback) {\n      var skipDebouncer = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n      this.saveItems([item], callback, skipDebouncer);\n    }\n\n    /* Presave allows clients to perform any actions last second before the save actually occurs (like setting previews).\n       Saves debounce by default, so if a client needs to compute a property on an item before saving, it's best to\n       hook into the debounce cycle so that clients don't have to implement their own debouncing.\n     */\n\n  }, {\n    key: \"saveItemWithPresave\",\n    value: function saveItemWithPresave(item, presave, callback) {\n      this.saveItemsWithPresave([item], presave, callback);\n    }\n  }, {\n    key: \"saveItemsWithPresave\",\n    value: function saveItemsWithPresave(items, presave, callback) {\n      this.saveItems(items, callback, false, presave);\n    }\n\n    /*\n    skipDebouncer allows saves to go through right away rather than waiting for timeout.\n    This should be used when saving items via other means besides keystrokes.\n     */\n\n  }, {\n    key: \"saveItems\",\n    value: function saveItems(items, callback) {\n      var _this3 = this;\n\n      var skipDebouncer = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      var presave = arguments[3];\n\n      var saveBlock = function saveBlock() {\n        // presave block allows client to gain the benefit of performing something in the debounce cycle.\n        presave && presave();\n\n        var mappedItems = items.map(function (item) {\n          item.updated_at = new Date();\n          return this.jsonObjectForItem(item);\n        }.bind(_this3));\n\n        _this3.postMessage(\"save-items\", { items: mappedItems }, function (data) {\n          callback && callback();\n        });\n      };\n\n      /*\n        Coallesed saving prevents saves from being made after every keystroke, and instead\n        waits coallesedSavingDelay before performing action. For example, if a user types a keystroke, and the clienet calls saveItem,\n        a 250ms delay will begin. If they type another keystroke within 250ms, the previously pending\n        save will be cancelled, and another 250ms delay occurs. If ater 250ms the pending delay is not cleared by a future call,\n        the save will finally trigger.\n         Note: it's important to modify saving items updated_at immediately and not after delay. If you modify after delay,\n        a delayed sync could just be wrapping up, and will send back old data and replace what the user has typed.\n      */\n      if (this.coallesedSaving == true && !skipDebouncer) {\n        if (this.pendingSave) {\n          clearTimeout(this.pendingSave);\n        }\n\n        this.pendingSave = setTimeout(function () {\n          saveBlock();\n        }, this.coallesedSavingDelay);\n      } else {\n        saveBlock();\n      }\n    }\n  }, {\n    key: \"jsonObjectForItem\",\n    value: function jsonObjectForItem(item) {\n      var copy = Object.assign({}, item);\n      copy.children = null;\n      copy.parent = null;\n      return copy;\n    }\n  }, {\n    key: \"getItemAppDataValue\",\n    value: function getItemAppDataValue(item, key) {\n      var AppDomain = \"org.standardnotes.sn\";\n      var data = item.content.appData && item.content.appData[AppDomain];\n      if (data) {\n        return data[key];\n      } else {\n        return null;\n      }\n    }\n\n    /* Themes */\n\n  }, {\n    key: \"activateThemes\",\n    value: function activateThemes(incomingUrls) {\n      if (this.loggingEnabled) {\n        console.log(\"Incoming themes\", incomingUrls);\n      }\n      if (this.activeThemes.sort().toString() == incomingUrls.sort().toString()) {\n        // incoming are same as active, do nothing\n        return;\n      }\n\n      var themesToActivate = incomingUrls || [];\n      var themesToDeactivate = [];\n\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = this.activeThemes[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var activeUrl = _step2.value;\n\n          if (!incomingUrls.includes(activeUrl)) {\n            // active not present in incoming, deactivate it\n            themesToDeactivate.push(activeUrl);\n          } else {\n            // already present in active themes, remove it from themesToActivate\n            themesToActivate = themesToActivate.filter(function (candidate) {\n              return candidate != activeUrl;\n            });\n          }\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      if (this.loggingEnabled) {\n        console.log(\"Deactivating themes:\", themesToDeactivate);\n        console.log(\"Activating themes:\", themesToActivate);\n      }\n\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = themesToDeactivate[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var theme = _step3.value;\n\n          this.deactivateTheme(theme);\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n\n      this.activeThemes = incomingUrls;\n\n      var _iteratorNormalCompletion4 = true;\n      var _didIteratorError4 = false;\n      var _iteratorError4 = undefined;\n\n      try {\n        for (var _iterator4 = themesToActivate[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n          var url = _step4.value;\n\n          if (!url) {\n            continue;\n          }\n\n          var link = document.createElement(\"link\");\n          link.id = btoa(url);\n          link.href = url;\n          link.type = \"text/css\";\n          link.rel = \"stylesheet\";\n          link.media = \"screen,print\";\n          link.className = \"custom-theme\";\n          document.getElementsByTagName(\"head\")[0].appendChild(link);\n        }\n      } catch (err) {\n        _didIteratorError4 = true;\n        _iteratorError4 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion4 && _iterator4.return) {\n            _iterator4.return();\n          }\n        } finally {\n          if (_didIteratorError4) {\n            throw _iteratorError4;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"themeElementForUrl\",\n    value: function themeElementForUrl(url) {\n      var elements = Array.from(document.getElementsByClassName(\"custom-theme\")).slice();\n      return elements.find(function (element) {\n        // We used to search here by `href`, but on desktop, with local file:// urls, that didn't work for some reason.\n        return element.id == btoa(url);\n      });\n    }\n  }, {\n    key: \"deactivateTheme\",\n    value: function deactivateTheme(url) {\n      var element = this.themeElementForUrl(url);\n      if (element) {\n        element.disabled = true;\n        element.parentNode.removeChild(element);\n      }\n    }\n\n    /* Theme caching is currently disabled. Might be enabled in the future if neccessary. */\n    /*\n    activateCachedThemes() {\n      let themes = this.getCachedThemeUrls();\n      let writeToCache = false;\n      if(this.loggingEnabled) { console.log(\"Activating cached themes\", themes); }\n      this.activateThemes(themes, writeToCache);\n    }\n     cacheThemeUrls(urls) {\n      if(this.loggingEnabled) { console.log(\"Caching theme urls\", urls); }\n      localStorage.setItem(\"cachedThemeUrls\", JSON.stringify(urls));\n    }\n     decacheThemeUrls() {\n      localStorage.removeItem(\"cachedThemeUrls\");\n    }\n     getCachedThemeUrls() {\n      let urls = localStorage.getItem(\"cachedThemeUrls\");\n      if(urls) {\n        return JSON.parse(urls);\n      } else {\n        return [];\n      }\n    }\n    */\n\n    /* Utilities */\n\n  }, {\n    key: \"generateUUID\",\n    value: function generateUUID() {\n      var crypto = window.crypto || window.msCrypto;\n      if (crypto) {\n        var buf = new Uint32Array(4);\n        crypto.getRandomValues(buf);\n        var idx = -1;\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          idx++;\n          var r = buf[idx >> 3] >> idx % 8 * 4 & 15;\n          var v = c == 'x' ? r : r & 0x3 | 0x8;\n          return v.toString(16);\n        });\n      } else {\n        var d = new Date().getTime();\n        if (window.performance && typeof window.performance.now === \"function\") {\n          d += performance.now(); //use high-precision timer if available\n        }\n        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          var r = (d + Math.random() * 16) % 16 | 0;\n          d = Math.floor(d / 16);\n          return (c == 'x' ? r : r & 0x3 | 0x8).toString(16);\n        });\n        return uuid;\n      }\n    }\n  }]);\n\n  return ComponentManager;\n}();\n\nif (typeof module != \"undefined\" && typeof module.exports != \"undefined\") {\n  module.exports = ComponentManager;\n}\n\nif (window) {\n  window.ComponentManager = ComponentManager;\n}\n//# sourceMappingURL=dist.js.map\n;\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SNTheme = exports.SNSmartTag = exports.SNServerExtension = exports.SNMfa = exports.SNEncryptedStorage = exports.SNTag = exports.SNNote = exports.SNExtension = exports.Action = exports.SNEditor = exports.SNComponent = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _standardFileJs = require(\"standard-file-js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar SNComponent = exports.SNComponent = function (_SFItem) {\n  _inherits(SNComponent, _SFItem);\n\n  function SNComponent(json_obj) {\n    _classCallCheck(this, SNComponent);\n\n    // If making a copy of an existing component (usually during sign in if you have a component active in the session),\n    // which may have window set, you may get a cross-origin exception since you'll be trying to copy the window. So we clear it here.\n    json_obj.window = null;\n\n    var _this = _possibleConstructorReturn(this, (SNComponent.__proto__ || Object.getPrototypeOf(SNComponent)).call(this, json_obj));\n\n    if (!_this.componentData) {\n      _this.componentData = {};\n    }\n\n    if (!_this.disassociatedItemIds) {\n      _this.disassociatedItemIds = [];\n    }\n\n    if (!_this.associatedItemIds) {\n      _this.associatedItemIds = [];\n    }\n    return _this;\n  }\n\n  _createClass(SNComponent, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      /* Legacy */\n      // We don't want to set the url directly, as we'd like to phase it out.\n      // If the content.url exists, we'll transfer it to legacy_url\n      // We'll only need to set this if content.hosted_url is blank, otherwise, hosted_url is the url replacement.\n      if (!content.hosted_url) {\n        this.legacy_url = content.url;\n      }\n\n      /* New */\n      this.local_url = content.local_url;\n      this.hosted_url = content.hosted_url || content.url;\n      this.offlineOnly = content.offlineOnly;\n\n      if (content.valid_until) {\n        this.valid_until = new Date(content.valid_until);\n      }\n\n      this.name = content.name;\n      this.autoupdateDisabled = content.autoupdateDisabled;\n\n      this.package_info = content.package_info;\n\n      // the location in the view this component is located in. Valid values are currently tags-list, note-tags, and editor-stack`\n      this.area = content.area;\n\n      this.permissions = content.permissions;\n      if (!this.permissions) {\n        this.permissions = [];\n      }\n\n      this.active = content.active;\n\n      // custom data that a component can store in itself\n      this.componentData = content.componentData || {};\n\n      // items that have requested a component to be disabled in its context\n      this.disassociatedItemIds = content.disassociatedItemIds || [];\n\n      // items that have requested a component to be enabled in its context\n      this.associatedItemIds = content.associatedItemIds || [];\n    }\n  }, {\n    key: \"handleDeletedContent\",\n    value: function handleDeletedContent() {\n      _get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"handleDeletedContent\", this).call(this);\n\n      this.active = false;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        legacy_url: this.legacy_url,\n        hosted_url: this.hosted_url,\n        local_url: this.local_url,\n        valid_until: this.valid_until,\n        offlineOnly: this.offlineOnly,\n        name: this.name,\n        area: this.area,\n        package_info: this.package_info,\n        permissions: this.permissions,\n        active: this.active,\n        autoupdateDisabled: this.autoupdateDisabled,\n        componentData: this.componentData,\n        disassociatedItemIds: this.disassociatedItemIds,\n        associatedItemIds: this.associatedItemIds\n      };\n\n      var superParams = _get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"isEditor\",\n    value: function isEditor() {\n      return this.area == \"editor-editor\";\n    }\n  }, {\n    key: \"isTheme\",\n    value: function isTheme() {\n      return this.content_type == \"SN|Theme\" || this.area == \"themes\";\n    }\n  }, {\n    key: \"isDefaultEditor\",\n    value: function isDefaultEditor() {\n      return this.getAppDataItem(\"defaultEditor\") == true;\n    }\n  }, {\n    key: \"setLastSize\",\n    value: function setLastSize(size) {\n      this.setAppDataItem(\"lastSize\", size);\n    }\n  }, {\n    key: \"getLastSize\",\n    value: function getLastSize() {\n      return this.getAppDataItem(\"lastSize\");\n    }\n  }, {\n    key: \"acceptsThemes\",\n    value: function acceptsThemes() {\n      if (this.content.package_info && \"acceptsThemes\" in this.content.package_info) {\n        return this.content.package_info.acceptsThemes;\n      }\n      return true;\n    }\n\n    /*\n      The key used to look up data that this component may have saved to an item.\n      This key will be look up on the item, and not on itself.\n     */\n\n  }, {\n    key: \"getClientDataKey\",\n    value: function getClientDataKey() {\n      if (this.legacy_url) {\n        return this.legacy_url;\n      } else {\n        return this.uuid;\n      }\n    }\n  }, {\n    key: \"hasValidHostedUrl\",\n    value: function hasValidHostedUrl() {\n      return this.hosted_url || this.legacy_url;\n    }\n  }, {\n    key: \"keysToIgnoreWhenCheckingContentEquality\",\n    value: function keysToIgnoreWhenCheckingContentEquality() {\n      return [\"active\"].concat(_get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"keysToIgnoreWhenCheckingContentEquality\", this).call(this));\n    }\n\n    /*\n      An associative component depends on being explicitly activated for a given item, compared to a dissaciative component,\n      which is enabled by default in areas unrelated to a certain item.\n     */\n\n  }, {\n    key: \"isAssociative\",\n    value: function isAssociative() {\n      return Component.associativeAreas().includes(this.area);\n    }\n  }, {\n    key: \"associateWithItem\",\n    value: function associateWithItem(item) {\n      this.associatedItemIds.push(item.uuid);\n    }\n  }, {\n    key: \"isExplicitlyEnabledForItem\",\n    value: function isExplicitlyEnabledForItem(item) {\n      return this.associatedItemIds.indexOf(item.uuid) !== -1;\n    }\n  }, {\n    key: \"isExplicitlyDisabledForItem\",\n    value: function isExplicitlyDisabledForItem(item) {\n      return this.disassociatedItemIds.indexOf(item.uuid) !== -1;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|Component\";\n    }\n  }], [{\n    key: \"associativeAreas\",\n    value: function associativeAreas() {\n      return [\"editor-editor\"];\n    }\n  }]);\n\n  return SNComponent;\n}(_standardFileJs.SFItem);\n\n;\nvar SNEditor = exports.SNEditor = function (_SFItem2) {\n  _inherits(SNEditor, _SFItem2);\n\n  function SNEditor(json_obj) {\n    _classCallCheck(this, SNEditor);\n\n    var _this2 = _possibleConstructorReturn(this, (SNEditor.__proto__ || Object.getPrototypeOf(SNEditor)).call(this, json_obj));\n\n    if (!_this2.notes) {\n      _this2.notes = [];\n    }\n    if (!_this2.data) {\n      _this2.data = {};\n    }\n    return _this2;\n  }\n\n  _createClass(SNEditor, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.url = content.url;\n      this.name = content.name;\n      this.data = content.data || {};\n      this.default = content.default;\n      this.systemEditor = content.systemEditor;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        url: this.url,\n        name: this.name,\n        data: this.data,\n        default: this.default,\n        systemEditor: this.systemEditor\n      };\n\n      var superParams = _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"referenceParams\",\n    value: function referenceParams() {\n      var references = _.map(this.notes, function (note) {\n        return { uuid: note.uuid, content_type: note.content_type };\n      });\n\n      return references;\n    }\n  }, {\n    key: \"addItemAsRelationship\",\n    value: function addItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        if (!_.find(this.notes, item)) {\n          this.notes.push(item);\n        }\n      }\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"addItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"removeItemAsRelationship\",\n    value: function removeItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        _.pull(this.notes, item);\n      }\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"removeItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"removeAndDirtyAllRelationships\",\n    value: function removeAndDirtyAllRelationships() {\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"removeAndDirtyAllRelationships\", this).call(this);\n      this.notes = [];\n    }\n  }, {\n    key: \"removeReferencesNotPresentIn\",\n    value: function removeReferencesNotPresentIn(references) {\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"removeReferencesNotPresentIn\", this).call(this, references);\n\n      var uuids = references.map(function (ref) {\n        return ref.uuid;\n      });\n      this.notes.forEach(function (note) {\n        if (!uuids.includes(note.uuid)) {\n          _.remove(this.notes, { uuid: note.uuid });\n        }\n      }.bind(this));\n    }\n  }, {\n    key: \"potentialItemOfInterestHasChangedItsUUID\",\n    value: function potentialItemOfInterestHasChangedItsUUID(newItem, oldUUID, newUUID) {\n      if (newItem.content_type === \"Note\" && _.find(this.notes, { uuid: oldUUID })) {\n        _.remove(this.notes, { uuid: oldUUID });\n        this.notes.push(newItem);\n      }\n    }\n  }, {\n    key: \"setData\",\n    value: function setData(key, value) {\n      var dataHasChanged = JSON.stringify(this.data[key]) !== JSON.stringify(value);\n      if (dataHasChanged) {\n        this.data[key] = value;\n        return true;\n      }\n      return false;\n    }\n  }, {\n    key: \"dataForKey\",\n    value: function dataForKey(key) {\n      return this.data[key] || {};\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|Editor\";\n    }\n  }]);\n\n  return SNEditor;\n}(_standardFileJs.SFItem);\n\n;\nvar Action = exports.Action = function Action(json) {\n  _classCallCheck(this, Action);\n\n  _.merge(this, json);\n  this.running = false; // in case running=true was synced with server since model is uploaded nondiscriminatory\n  this.error = false;\n  if (this.lastExecuted) {\n    // is string\n    this.lastExecuted = new Date(this.lastExecuted);\n  }\n};\n\nvar SNExtension = exports.SNExtension = function (_SFItem3) {\n  _inherits(SNExtension, _SFItem3);\n\n  function SNExtension(json) {\n    _classCallCheck(this, SNExtension);\n\n    var _this3 = _possibleConstructorReturn(this, (SNExtension.__proto__ || Object.getPrototypeOf(SNExtension)).call(this, json));\n\n    if (json.actions) {\n      _this3.actions = json.actions.map(function (action) {\n        return new Action(action);\n      });\n    }\n\n    if (!_this3.actions) {\n      _this3.actions = [];\n    }\n    return _this3;\n  }\n\n  _createClass(SNExtension, [{\n    key: \"actionsWithContextForItem\",\n    value: function actionsWithContextForItem(item) {\n      return this.actions.filter(function (action) {\n        return action.context == item.content_type || action.context == \"Item\";\n      });\n    }\n  }, {\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNExtension.prototype.__proto__ || Object.getPrototypeOf(SNExtension.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.description = content.description;\n      this.url = content.url;\n      this.name = content.name;\n      this.package_info = content.package_info;\n      this.supported_types = content.supported_types;\n      if (content.actions) {\n        this.actions = content.actions.map(function (action) {\n          return new Action(action);\n        });\n      }\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        name: this.name,\n        url: this.url,\n        package_info: this.package_info,\n        description: this.description,\n        actions: this.actions.map(function (a) {\n          return _.omit(a, [\"subrows\", \"subactions\"]);\n        }),\n        supported_types: this.supported_types\n      };\n\n      var superParams = _get(SNExtension.prototype.__proto__ || Object.getPrototypeOf(SNExtension.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"Extension\";\n    }\n  }]);\n\n  return SNExtension;\n}(_standardFileJs.SFItem);\n\n;\nvar SNNote = exports.SNNote = function (_SFItem4) {\n  _inherits(SNNote, _SFItem4);\n\n  function SNNote(json_obj) {\n    _classCallCheck(this, SNNote);\n\n    var _this4 = _possibleConstructorReturn(this, (SNNote.__proto__ || Object.getPrototypeOf(SNNote)).call(this, json_obj));\n\n    if (!_this4.text) {\n      // Some external editors can't handle a null value for text.\n      // Notes created on mobile with no text have a null value for it,\n      // so we'll just set a default here.\n      _this4.text = \"\";\n    }\n\n    if (!_this4.tags) {\n      _this4.tags = [];\n    }\n    return _this4;\n  }\n\n  _createClass(SNNote, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.title = content.title;\n      this.text = content.text;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        title: this.title,\n        text: this.text\n      };\n\n      var superParams = _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"addItemAsRelationship\",\n    value: function addItemAsRelationship(item) {\n      /*\n      Legacy.\n      Previously, note/tag relationships were bidirectional, however in some cases there\n      may be broken links such that a note has references to a tag and not vice versa.\n      Now, only tags contain references to notes. For old notes that may have references to tags,\n      we want to transfer them over to the tag.\n       */\n      if (item.content_type == \"Tag\") {\n        item.addItemAsRelationship(this);\n      }\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"addItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"setIsBeingReferencedBy\",\n    value: function setIsBeingReferencedBy(item) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"setIsBeingReferencedBy\", this).call(this, item);\n      this.clearSavedTagsString();\n    }\n  }, {\n    key: \"setIsNoLongerBeingReferencedBy\",\n    value: function setIsNoLongerBeingReferencedBy(item) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"setIsNoLongerBeingReferencedBy\", this).call(this, item);\n      this.clearSavedTagsString();\n    }\n  }, {\n    key: \"isBeingRemovedLocally\",\n    value: function isBeingRemovedLocally() {\n      this.tags.forEach(function (tag) {\n        _.remove(tag.notes, { uuid: this.uuid });\n      }.bind(this));\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"isBeingRemovedLocally\", this).call(this);\n    }\n  }, {\n    key: \"informReferencesOfUUIDChange\",\n    value: function informReferencesOfUUIDChange(oldUUID, newUUID) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"informReferencesOfUUIDChange\", this).call(this);\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.tags[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var tag = _step.value;\n\n          _.remove(tag.notes, { uuid: oldUUID });\n          tag.notes.push(this);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"tagDidFinishSyncing\",\n    value: function tagDidFinishSyncing(tag) {\n      this.clearSavedTagsString();\n    }\n  }, {\n    key: \"safeText\",\n    value: function safeText() {\n      return this.text || \"\";\n    }\n  }, {\n    key: \"safeTitle\",\n    value: function safeTitle() {\n      return this.title || \"\";\n    }\n  }, {\n    key: \"clearSavedTagsString\",\n    value: function clearSavedTagsString() {\n      this.savedTagsString = null;\n    }\n  }, {\n    key: \"tagsString\",\n    value: function tagsString() {\n      this.savedTagsString = SNTag.arrayToDisplayString(this.tags);\n      return this.savedTagsString;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"Note\";\n    }\n  }, {\n    key: \"displayName\",\n    get: function get() {\n      return \"Note\";\n    }\n  }], [{\n    key: \"filterDummyNotes\",\n    value: function filterDummyNotes(notes) {\n      var filtered = notes.filter(function (note) {\n        return note.dummy == false || note.dummy == null;\n      });\n      return filtered;\n    }\n  }]);\n\n  return SNNote;\n}(_standardFileJs.SFItem);\n\n;\nvar SNTag = exports.SNTag = function (_SFItem5) {\n  _inherits(SNTag, _SFItem5);\n\n  function SNTag(json_obj) {\n    _classCallCheck(this, SNTag);\n\n    var _this5 = _possibleConstructorReturn(this, (SNTag.__proto__ || Object.getPrototypeOf(SNTag)).call(this, json_obj));\n\n    if (!_this5.content_type) {\n      _this5.content_type = \"Tag\";\n    }\n\n    if (!_this5.notes) {\n      _this5.notes = [];\n    }\n    return _this5;\n  }\n\n  _createClass(SNTag, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.title = content.title;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        title: this.title\n      };\n\n      var superParams = _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"addItemAsRelationship\",\n    value: function addItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        if (!_.find(this.notes, { uuid: item.uuid })) {\n          this.notes.push(item);\n          item.tags.push(this);\n        }\n      }\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"addItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"removeItemAsRelationship\",\n    value: function removeItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        _.remove(this.notes, { uuid: item.uuid });\n        _.remove(item.tags, { uuid: this.uuid });\n      }\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"removeItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"updateLocalRelationships\",\n    value: function updateLocalRelationships() {\n      var references = this.content.references;\n\n      var uuids = references.map(function (ref) {\n        return ref.uuid;\n      });\n      this.notes.slice().forEach(function (note) {\n        if (!uuids.includes(note.uuid)) {\n          _.remove(note.tags, { uuid: this.uuid });\n          _.remove(this.notes, { uuid: note.uuid });\n\n          note.setIsNoLongerBeingReferencedBy(this);\n        }\n      }.bind(this));\n    }\n  }, {\n    key: \"isBeingRemovedLocally\",\n    value: function isBeingRemovedLocally() {\n      var _this6 = this;\n\n      this.notes.forEach(function (note) {\n        _.remove(note.tags, { uuid: _this6.uuid });\n        note.setIsNoLongerBeingReferencedBy(_this6);\n      });\n\n      this.notes.length = 0;\n\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"isBeingRemovedLocally\", this).call(this);\n    }\n  }, {\n    key: \"informReferencesOfUUIDChange\",\n    value: function informReferencesOfUUIDChange(oldUUID, newUUID) {\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = this.notes[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var note = _step2.value;\n\n          _.remove(note.tags, { uuid: oldUUID });\n          note.tags.push(this);\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"didFinishSyncing\",\n    value: function didFinishSyncing() {\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = this.notes[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var note = _step3.value;\n\n          note.tagDidFinishSyncing(this);\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"isSmartTag\",\n    value: function isSmartTag() {\n      return this.content_type == \"SN|SmartTag\";\n    }\n  }, {\n    key: \"displayName\",\n    get: function get() {\n      return \"Tag\";\n    }\n  }], [{\n    key: \"arrayToDisplayString\",\n    value: function arrayToDisplayString(tags) {\n      return tags.sort(function (a, b) {\n        return a.title > b.title;\n      }).map(function (tag, i) {\n        return \"#\" + tag.title;\n      }).join(\" \");\n    }\n  }]);\n\n  return SNTag;\n}(_standardFileJs.SFItem);\n\n;\nvar SNEncryptedStorage = exports.SNEncryptedStorage = function (_SFItem6) {\n  _inherits(SNEncryptedStorage, _SFItem6);\n\n  function SNEncryptedStorage() {\n    _classCallCheck(this, SNEncryptedStorage);\n\n    return _possibleConstructorReturn(this, (SNEncryptedStorage.__proto__ || Object.getPrototypeOf(SNEncryptedStorage)).apply(this, arguments));\n  }\n\n  _createClass(SNEncryptedStorage, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNEncryptedStorage.prototype.__proto__ || Object.getPrototypeOf(SNEncryptedStorage.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.storage = content.storage;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|EncryptedStorage\";\n    }\n  }]);\n\n  return SNEncryptedStorage;\n}(_standardFileJs.SFItem);\n\n;\nvar SNMfa = exports.SNMfa = function (_SFItem7) {\n  _inherits(SNMfa, _SFItem7);\n\n  function SNMfa(json_obj) {\n    _classCallCheck(this, SNMfa);\n\n    return _possibleConstructorReturn(this, (SNMfa.__proto__ || Object.getPrototypeOf(SNMfa)).call(this, json_obj));\n  }\n\n  // mapContentToLocalProperties(content) {\n  //   super.mapContentToLocalProperties(content)\n  //   this.serverContent = content;\n  // }\n  //\n  // structureParams() {\n  //   return _.merge(this.serverContent, super.structureParams());\n  // }\n\n  _createClass(SNMfa, [{\n    key: \"doNotEncrypt\",\n    value: function doNotEncrypt() {\n      return true;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SF|MFA\";\n    }\n  }]);\n\n  return SNMfa;\n}(_standardFileJs.SFItem);\n\n;\nvar SNServerExtension = exports.SNServerExtension = function (_SFItem8) {\n  _inherits(SNServerExtension, _SFItem8);\n\n  function SNServerExtension() {\n    _classCallCheck(this, SNServerExtension);\n\n    return _possibleConstructorReturn(this, (SNServerExtension.__proto__ || Object.getPrototypeOf(SNServerExtension)).apply(this, arguments));\n  }\n\n  _createClass(SNServerExtension, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNServerExtension.prototype.__proto__ || Object.getPrototypeOf(SNServerExtension.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.url = content.url;\n    }\n  }, {\n    key: \"doNotEncrypt\",\n    value: function doNotEncrypt() {\n      return true;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SF|Extension\";\n    }\n  }]);\n\n  return SNServerExtension;\n}(_standardFileJs.SFItem);\n\n;\nvar SNSmartTag = exports.SNSmartTag = function (_SNTag) {\n  _inherits(SNSmartTag, _SNTag);\n\n  function SNSmartTag(json_ob) {\n    _classCallCheck(this, SNSmartTag);\n\n    var _this10 = _possibleConstructorReturn(this, (SNSmartTag.__proto__ || Object.getPrototypeOf(SNSmartTag)).call(this, json_ob));\n\n    _this10.content_type = \"SN|SmartTag\";\n    return _this10;\n  }\n\n  _createClass(SNSmartTag, null, [{\n    key: \"systemSmartTags\",\n    value: function systemSmartTags() {\n      return [new SNSmartTag({\n        uuid: SNSmartTag.SystemSmartTagIdAllNotes,\n        content: {\n          title: \"All notes\",\n          isSystemTag: true,\n          isAllTag: true,\n          predicate: new SFPredicate.fromArray([\"content_type\", \"=\", \"Note\"])\n        }\n      }), new SNSmartTag({\n        uuid: SNSmartTag.SystemSmartTagIdArchivedNotes,\n        content: {\n          title: \"Archived\",\n          isSystemTag: true,\n          isArchiveTag: true,\n          predicate: new SFPredicate.fromArray([\"archived\", \"=\", true])\n        }\n      }), new SNSmartTag({\n        uuid: SNSmartTag.SystemSmartTagIdTrashedNotes,\n        content: {\n          title: \"Trash\",\n          isSystemTag: true,\n          isTrashTag: true,\n          predicate: new SFPredicate.fromArray([\"content.trashed\", \"=\", true])\n        }\n      })];\n    }\n  }]);\n\n  return SNSmartTag;\n}(SNTag);\n\nSNSmartTag.SystemSmartTagIdAllNotes = \"all-notes\";\nSNSmartTag.SystemSmartTagIdArchivedNotes = \"archived-notes\";\nSNSmartTag.SystemSmartTagIdTrashedNotes = \"trashed-notes\";\n;\nvar SNTheme = exports.SNTheme = function (_SNComponent) {\n  _inherits(SNTheme, _SNComponent);\n\n  function SNTheme(json_obj) {\n    _classCallCheck(this, SNTheme);\n\n    var _this11 = _possibleConstructorReturn(this, (SNTheme.__proto__ || Object.getPrototypeOf(SNTheme)).call(this, json_obj));\n\n    _this11.area = \"themes\";\n    return _this11;\n  }\n\n  _createClass(SNTheme, [{\n    key: \"isLayerable\",\n    value: function isLayerable() {\n      return this.package_info && this.package_info.layerable;\n    }\n  }, {\n    key: \"setMobileRules\",\n    value: function setMobileRules(rules) {\n      this.setAppDataItem(\"mobileRules\", rules);\n    }\n  }, {\n    key: \"getMobileRules\",\n    value: function getMobileRules() {\n      return this.getAppDataItem(\"mobileRules\") || { constants: {}, rules: {} };\n    }\n\n    // Same as getMobileRules but without default value\n\n  }, {\n    key: \"hasMobileRules\",\n    value: function hasMobileRules() {\n      return this.getAppDataItem(\"mobileRules\");\n    }\n  }, {\n    key: \"setNotAvailOnMobile\",\n    value: function setNotAvailOnMobile(na) {\n      this.setAppDataItem(\"notAvailableOnMobile\", na);\n    }\n  }, {\n    key: \"getNotAvailOnMobile\",\n    value: function getNotAvailOnMobile() {\n      return this.getAppDataItem(\"notAvailableOnMobile\");\n    }\n\n    /* We must not use .active because if you set that to true, it will also activate that theme on desktop/web */\n\n  }, {\n    key: \"setMobileActive\",\n    value: function setMobileActive(active) {\n      this.setAppDataItem(\"mobileActive\", active);\n    }\n  }, {\n    key: \"isMobileActive\",\n    value: function isMobileActive() {\n      return this.getAppDataItem(\"mobileActive\");\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|Theme\";\n    }\n  }, {\n    key: \"displayName\",\n    get: function get() {\n      return \"Theme\";\n    }\n  }]);\n\n  return SNTheme;\n}(SNComponent);\n\n;\n\nif (typeof window !== 'undefined' && window !== null) {\n  // window is for some reason defined in React Native, but throws an exception when you try to set to it\n  try {\n    window.SNNote = SNNote;\n    window.SNTag = SNTag;\n    window.SNSmartTag = SNSmartTag;\n    window.SNMfa = SNMfa;\n    window.SNServerExtension = SNServerExtension;\n    window.SNComponent = SNComponent;\n    window.SNEditor = SNEditor;\n    window.SNExtension = SNExtension;\n    window.SNTheme = SNTheme;\n    window.SNEncryptedStorage = SNEncryptedStorage;\n  } catch (e) {\n    console.log(\"Exception while exporting sn-models window variables\", e);\n  }\n}\n//# sourceMappingURL=transpiled.js.map\n;'use strict';\n\nangular.module('app', [\n\n])\n;class HomeCtrl {\n  constructor($rootScope, $scope, $timeout) {\n\n    let smartTagContentType = \"SN|SmartTag\";\n\n    let componentManager = new window.ComponentManager([], () => {\n      // on ready\n      $rootScope.platform = componentManager.platform;\n    });\n\n    let delimiter = \".\";\n\n    $scope.resolveRawTags = function(masterTag) {\n      let sortTags = (tags) => {\n        return tags.sort((a, b) => (a.content.title > b.content.title) - (a.content.title < b.content.title));\n      }\n      var resolved = masterTag.rawTags.slice();\n\n      var findResolvedTag = function(title) {\n        for(var tag of masterTag.rawTags) {\n          if(tag.content.title === title) {\n            return tag;\n          }\n        }\n        return null;\n      }\n\n      for(var tag of masterTag.rawTags) {\n        var pendingDummy = tag.children && tag.children.find((c) => {return c.dummy});\n        tag.children = [];\n        tag.parent = null;\n\n        if(pendingDummy) {\n          tag.children.unshift(pendingDummy);\n        }\n      };\n\n      for(var tag of masterTag.rawTags) {\n        var name = tag.content.title;\n        var comps = name.split(delimiter);\n        tag.displayTitle = comps[comps.length -1];\n        if(comps.length == 1) {\n          tag.parent = masterTag;\n          continue;\n        }\n\n        var getParent = function(depth = 1) {\n          var parentTitle = comps.slice(0, comps.length - depth).join(delimiter);\n          if(parentTitle.length == 0) {\n            return null;\n          }\n          var parent = findResolvedTag(parentTitle);\n\n          // didn't find parent, try again.\n          // just make sure we're not deeper in search than we can go\n          if(!parent && depth < comps.length - 1) {\n            return getParent(depth + 1);\n          }\n\n          // remove parent from name and keep this full tag name to display\n          var tagTitle = tag.content.title.slice(parentTitle.length+1);\n          tag.displayTitle = tagTitle;\n\n          return parent;\n        };\n\n        var parent = getParent();\n\n        // no parent at all up the tree, fall back to root with full name\n        if(!parent) {\n          tag.displayTitle = tag.content.title;\n          tag.parent = masterTag;\n          continue;\n        }\n\n        parent.children.push(tag);\n        parent.children = sortTags(parent.children);\n        tag.parent = parent;\n\n        // remove chid from master list\n        var index = resolved.indexOf(tag);\n        resolved.splice(index, 1);\n\n        if($scope.selectedTag && $scope.selectedTag.uuid == tag.uuid) {\n          $scope.selectedTag = tag;\n          $scope.setSelectedForTag(tag, true);\n        }\n      }\n\n      var pendingDummy = masterTag.children && masterTag.children.find((c) => {return c.dummy});\n      masterTag.children = sortTags(resolved);\n      if(pendingDummy) { masterTag.children.unshift(pendingDummy); }\n    }\n\n    $scope.changeParent = function(sourceId, targetId) {\n      var source = $scope.masterTag.rawTags.filter(function(tag){\n        return tag.uuid === sourceId;\n      })[0];\n\n      var target = targetId === \"0\" ? $scope.masterTag : $scope.masterTag.rawTags.filter(function(tag){\n        return tag.uuid === targetId;\n      })[0];\n\n      if(target.parent === source) {\n        return;\n      }\n\n      var needsSave = [source];\n\n      var adjustChildren = function(source) {\n        for(var child of source.children) {\n          var newTitle = source.content.title + delimiter + child.content.title.split(delimiter).slice(-1)[0];\n          child.content.title = newTitle;\n          needsSave.push(child);\n          adjustChildren(child);\n        }\n      }\n\n      var newTitle;\n      if(target.master) {\n        newTitle = source.content.title.split(delimiter).slice(-1)[0];\n      } else {\n        newTitle = target.content.title + delimiter + source.content.title.split(delimiter).slice(-1)[0];\n      }\n      source.content.title = newTitle;\n      adjustChildren(source);\n      $scope.resolveRawTags($scope.masterTag);\n\n      componentManager.saveItems(needsSave);\n    }\n\n    $scope.createTag = function(tag) {\n      var title = tag.content.title;\n      if(title.startsWith(\"![\")) {\n        /*\n        Create smart tag. Examples:\n        ![\"Not Pinned\", \"pinned\", \"=\", false]\n        ![\"Last Day\", \"updated_at\", \">\", \"1.days.ago\"]\n        ![\"Long\", \"text.length\", \">\", 500]\n        */\n        try {\n          var components = JSON.parse(title.substring(1, title.length));\n        } catch (e) {\n          alert(\"There was an error parsing your smart tag syntax. Please ensure the value after the exclamation mark is valid JSON, and try again.\")\n          return;\n        }\n        var smartTag = {\n          content_type: smartTagContentType,\n          content: {\n            title: components[0],\n            predicate: {\n              keypath: components[1],\n              operator: components[2],\n              value: components[3]\n            }\n          }\n        }\n        componentManager.createItem(smartTag, (createdTag) => {\n          // We don't want to select the tag right away because it hasn't been added yet.\n          // If you do $scope.selectTag(createdTag), an issue occurs where selecting another tag\n          // after that will not dehighlight this one.\n          $scope.selectOnLoad = createdTag;\n        });\n      } else {\n        tag.content_type = \"Tag\";\n        var title;\n        if(tag.parent.master) {\n          title = tag.content.title;\n        } else {\n          title = tag.parent.content.title + delimiter + tag.content.title;\n        }\n        tag.content.title = title;\n        tag.dummy = false;\n        componentManager.createItem(tag, (createdTag) => {\n          $scope.selectOnLoad = createdTag;\n        });\n      }\n    }\n\n    $scope.selectTag = function(tag, multiSelect) {\n      let isSmartTag = tag.content_type == smartTagContentType;\n      // Multi selection for smart tags is not possible.\n      if(isSmartTag) {\n        multiSelect = false;\n      }\n\n      let clearMultipleTagsSelection = function() {\n        if($scope.multipleTags) {\n          for(var selectedTag of $scope.multipleTags) {\n            $scope.setSelectedForTag(selectedTag, false);\n          }\n        }\n      }\n\n      if(tag.master || tag.smartMaster) {\n        clearMultipleTagsSelection();\n        $scope.multipleTags = [];\n        componentManager.clearSelection();\n      } else {\n        if(!$scope.multipleTags) { $scope.multipleTags = []; }\n        if(!isSmartTag) {\n          $scope.multipleTags.push(tag);\n        }\n        if(multiSelect && $scope.multipleTags.length > 1) {\n          var smartTag = $scope.createEphemeralSmartTagForMultiTags();\n          componentManager.selectItem(smartTag);\n        } else {\n          clearMultipleTagsSelection();\n          $scope.multipleTags = isSmartTag ? [] : [tag];\n          componentManager.selectItem(tag);\n        }\n      }\n\n      // if multiselect, we don't want to clear selected tag. But if master is selected,\n      // and multi select other tag, we do want to clear master. Rather than creating a large if\n      // statement, we'll just an if else.\n\n      if(!multiSelect && $scope.selectedTag && $scope.selectedTag != tag) {\n        $scope.setSelectedForTag($scope.selectedTag, false);\n        $scope.selectedTag.editing = false;\n      } else if($scope.selectedTag.master || $scope.selectedTag.smartMaster || $scope.selectedTag.content_type == smartTagContentType) {\n        $scope.setSelectedForTag($scope.selectedTag, false);\n      }\n\n      if($scope.selectedTag === tag && !tag.master && !tag.content.isSystemTag) {\n        tag.editing = true;\n      }\n\n      $scope.selectedTag = tag;\n      $scope.setSelectedForTag(tag, true);\n    }\n\n    $scope.createEphemeralSmartTagForMultiTags = function() {\n      let smartTag = {\n        uuid: Math.random(),\n        content_type: \"SN|SmartTag\",\n        content: {\n          title: \"Multiple tags\"\n        }\n      }\n\n      var tagNames = $scope.multipleTags.map((tag) => {return tag.content.title});\n      var predicate = [\"tags\", \"includes\", [\"title\", \"in\", tagNames]];\n      smartTag.content.predicate = predicate;\n      return smartTag;\n    }\n\n    $scope.toggleCollapse = function(tag) {\n      tag.clientData.collapsed = !tag.clientData.collapsed;\n      if(!tag.master) {\n        componentManager.saveItem(tag);\n      }\n    }\n\n    $scope.saveTags = function(tags) {\n      componentManager.saveItems(tags);\n    }\n\n    $scope.setSelectedForTag = function(tag, selected) {\n      tag.selected = selected;\n    }\n\n    componentManager.streamItems([\"Tag\", smartTagContentType], (newTags) => {\n      $timeout(() => {\n        var allTags = $scope.masterTag ? $scope.masterTag.rawTags : [];\n        var smartTags = $scope.smartMasterTag ? $scope.smartMasterTag.rawTags : SNSmartTag.systemSmartTags();\n        for(var tag of newTags) {\n          var isSmartTag = tag.content_type == smartTagContentType;\n          var arrayToUse = isSmartTag ? smartTags : allTags;\n\n          var existing = arrayToUse.filter((tagCandidate) => {\n            return tagCandidate.uuid === tag.uuid;\n          })[0];\n\n          if(existing) {\n            Object.assign(existing, tag);\n          } else if(tag.content.title) {\n            arrayToUse.push(tag);\n          }\n\n          if(tag.deleted) {\n            var index = arrayToUse.indexOf(existing || tag);\n            arrayToUse.splice(index, 1);\n          } else {\n            if($scope.selectOnLoad && $scope.selectOnLoad.uuid == tag.uuid)  {\n              $scope.selectOnLoad = null;\n              $scope.selectTag(tag);\n            } else if(existing && $scope.selectedTag && $scope.selectedTag.uuid == existing.uuid) {\n              // Don't call $scope.selectTag(existing) as this will double select a tag, which will enable editing for it.\n              $scope.setSelectedForTag(existing, true);\n            }\n          }\n        }\n\n        if(!$scope.masterTag) {\n          $scope.masterTag = {\n            master: true,\n            content: {\n              title: \"\"\n            },\n            displayTitle: \"All\",\n            uuid: \"0\",\n            clientData: {}\n          }\n        }\n\n        if(!$scope.smartMasterTag) {\n          $scope.smartMasterTag = {\n            master: true,\n            smartMaster: true,\n            content: {\n              title: \"\"\n            },\n            displayTitle: \"Views\",\n            uuid: \"1\",\n            clientData: {}\n          }\n        }\n\n        $scope.masterTag.rawTags = allTags;\n        $scope.smartMasterTag.rawTags = smartTags;\n\n        if(!$scope.selectedTag || ($scope.selectedTag && $scope.selectedTag.master)) {\n          if($scope.selectedTag && $scope.selectedTag.smartMaster) {\n            $scope.selectedTag = $scope.smartMasterTag;\n            $scope.setSelectedForTag($scope.masterTag, false);\n          } else {\n            $scope.selectedTag = $scope.masterTag;\n            $scope.setSelectedForTag($scope.smartMasterTag, false);\n          }\n          $scope.setSelectedForTag($scope.selectedTag, true);\n        }\n\n        if($scope.selectedTag.deleted) {\n          $scope.selectTag($scope.masterTag);\n        }\n\n        $scope.resolveRawTags($scope.masterTag);\n        $scope.resolveRawTags($scope.smartMasterTag);\n      })\n    });\n\n    $scope.deleteTag = function(tag) {\n      var isSmartTag = tag.content_type == smartTagContentType;\n      var arrayToUse = isSmartTag ? $scope.smartMasterTag.rawTags : $scope.masterTag.rawTags;\n\n      var tag = arrayToUse.filter(function(tagCandidate){\n        return tagCandidate.uuid === tag.uuid;\n      })[0];\n\n      var deleteChain = [];\n\n      function addChildren(tag) {\n        deleteChain.push(tag);\n        if(tag.children) {\n          for(var child of tag.children) {\n            addChildren(child);\n          }\n        }\n      }\n\n      addChildren(tag);\n\n      componentManager.deleteItems(deleteChain);\n    }\n  }\n}\n\n// required for firefox\nHomeCtrl.$$ngIsClass = true;\n\nangular.module('app').controller('HomeCtrl', HomeCtrl);\n;angular\n  .module('app')\n  .directive('mbAutofocus', ['$timeout', function($timeout) {\n    return {\n      restrict: 'A',\n      scope: {\n        shouldFocus: \"=\"\n      },\n      link : function($scope, $element) {\n        $timeout(function() {\n          if($scope.shouldFocus) {\n            $element[0].focus();\n          }\n        });\n      }\n    }\n  }]);\n;angular\n  .module('app')\n  .directive('draggable', function() {\n  return  {\n    scope: {\n      tagId: \"=\",\n      drop: '&',\n      isDraggable: \"=\",\n      isDroppable: \"=\"\n    },\n    link: function(scope, element, attrs) {\n      // 'ngInject';\n      var el = element[0];\n\n      el.draggable = scope.isDraggable;\n\n      var counter = 0;\n\n      el.addEventListener(\n        'dragstart',\n        function(e) {\n          counter = 0;\n          e.dataTransfer.effectAllowed = 'move';\n          e.dataTransfer.setData('TagId', JSON.stringify(scope.tagId));\n          this.classList.add('drag');\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragend',\n        function(e) {\n          this.classList.remove('drag');\n          this.classList.remove('over');\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragover',\n        function(e) {\n          e.dataTransfer.dropEffect = 'move';\n          // allows us to drop\n          if (e.preventDefault) e.preventDefault();\n          if(scope.isDroppable) { this.classList.add('over'); }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragenter',\n        function(e) {\n          counter++;\n          if(scope.isDroppable) { this.classList.add('over'); }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragleave',\n        function(e) {\n          counter--;\n           if (counter === 0) {\n             this.classList.remove('over');\n           }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragexit',\n        function(e) {\n          // counter--;\n          //  if (counter === 0) {\n             this.classList.remove('over');\n          //  }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'drop',\n        function(e) {\n\n          // Stops some browsers from redirecting.\n          counter = 0;\n          if (e.stopPropagation) e.stopPropagation();\n\n          this.classList.remove('over');\n\n          var targetId = JSON.parse(e.dataTransfer.getData('TagId'));\n          if(targetId === scope.tagId) {\n            return;\n          }\n          scope.$apply(function(scope) {\n            scope.drop()(targetId, scope.tagId);\n          });\n\n          return false;\n        },\n        false\n      );\n\n    }\n  }\n});\n;class TagTree {\n\n  constructor() {\n    this.restrict = \"C\";\n    this.templateUrl = \"directives/tag_tree.html\";\n    this.scope = {\n      tag: \"=\",\n      changeParent: \"&\",\n      onSelect: \"&\",\n      createTag: \"&\",\n      saveTags: \"&\",\n      deleteTag: \"&\",\n      onToggleCollapse: \"&\"\n    };\n  }\n\n  controller($scope, $timeout) {\n    'ngInject';\n\n    $scope.isDraggable = function() {\n      return !$scope.tag.master && $scope.tag.content_type != 'SN|SmartTag';\n    }\n\n    $scope.isDroppable = function() {\n      return !$scope.tag.smartMaster && $scope.tag.content_type != 'SN|SmartTag';\n    }\n\n    $scope.onDrop = function(sourceId, targetId) {\n      $scope.changeParent()(sourceId, targetId);\n    }\n\n    $scope.onDragOver = function(event) {\n\n    }\n\n    $scope.onDragStart = function(event) {\n\n    }\n\n    $scope.selectTag = function(event) {\n      let multiSelect = event.ctrlKey || event.metaKey;\n      $scope.onSelect()($scope.tag, multiSelect);\n    }\n\n    $scope.addChild = function($event, parent) {\n      $event.stopPropagation();\n      var addingTag = {dummy: true, parent: parent, content: {title: \"\"}};\n      parent.children.unshift(addingTag);\n    }\n\n    $scope.saveNewTag = function(tag) {\n      if(tag.content.title && tag.content.title.length > 0) {\n        $scope.createTag()(tag);\n      }\n      tag.parent.children.splice(tag.parent.children.indexOf(tag), 1);\n    }\n\n    $scope.removeTag = function(tag) {\n      $scope.deleteTag()(tag);\n    }\n\n    $scope.innerCollapse = function(tag) {\n      if($scope.onToggleCollapse()) {\n        $scope.onToggleCollapse()(tag);\n      }\n    }\n\n    $scope.saveTagRename = function(tag) {\n      if(!tag.displayTitle || tag.displayTitle.length == 0) {\n        // Delete\n        $scope.deleteTag()(tag);\n        return;\n      }\n      var delimiter = \".\";\n      var tags = [tag];\n      var title;\n      if(tag.parent.master) {\n        title = tag.displayTitle;\n      } else {\n        title = tag.parent.content.title + delimiter + tag.displayTitle;\n      }\n\n      tag.content.title = title;\n\n      function renameChildren(tag) {\n        for(var child of tag.children) {\n          child.content.title = child.parent.content.title + delimiter + child.displayTitle;\n          tags.push(child);\n          renameChildren(child);\n        }\n      }\n\n      renameChildren(tag);\n\n      tag.editing = false;\n\n      $scope.saveTags()(tags);\n    }\n\n    $scope.generationForTag = function(tag) {\n      var generation = 0;\n      var parent = tag.parent;\n      while(parent) {\n        generation++;\n        parent = parent.parent;\n      }\n\n      return generation;\n    }\n\n    $scope.circleClassForTag = function(tag) {\n      if(tag.content_type == \"SN|SmartTag\") {\n        return \"success\";\n      }\n\n      // is newly creating tag\n      if(!tag.uuid) {\n        return \"neutral\";\n      }\n\n\n      let gen = $scope.generationForTag(tag);\n      var circleClass = {\n        0: \"info\",\n        1: \"info\",\n        2: \"success\",\n        3: \"danger\",\n        4: \"warning\",\n      }[gen];\n\n      if(!circleClass) {\n        circleClass = \"neutral\";\n      }\n\n      // Newly creating tags don't have client data\n      if(tag.clientData && tag.clientData.collapsed) {\n        circleClass += \" no-bg\";\n      }\n\n      return circleClass;\n    }\n\n  }\n}\n\nTagTree.$$ngIsClass = true;\n\nangular.module('app').directive('tagTree', () => new TagTree);\n"]}